<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluating model performance • EnsembleRandomForests</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Evaluating model performance">
<meta property="og:description" content="EnsembleRandomForests">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EnsembleRandomForests</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-workflow.html">Getting started with ERF</a>
    </li>
    <li>
      <a href="../articles/model-perf.html">Evaluating model performance</a>
    </li>
    <li>
      <a href="../articles/helper-fn.html">Internal operations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/zsiders/EnsembleRandomForests/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Evaluating model performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zsiders/EnsembleRandomForests/blob/HEAD/vignettes/model-perf.Rmd" class="external-link"><code>vignettes/model-perf.Rmd</code></a></small>
      <div class="hidden name"><code>model-perf.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/zsiders/EnsembleRandomForests/" class="external-link">EnsembleRandomForests</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: doParallel</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: iterators</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span><span class="co">#&gt; Loading required package: randomForest</span></span>
<span><span class="co">#&gt; randomForest 4.7-1.1</span></span>
<span><span class="co">#&gt; Type rfNews() to see new features/changes/bug fixes.</span></span>
<span><span class="co"># run an ERF on the provided dataset</span></span>
<span><span class="va">ens_rf_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ens_random_forests.html">ens_random_forests</a></span><span class="op">(</span>df<span class="op">=</span><span class="va">simData</span><span class="op">$</span><span class="va">samples</span>, var<span class="op">=</span><span class="st">"obs"</span>,</span>
<span>                                covariates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"cov"</span>,</span>
<span>                                                <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">simData</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>,</span>
<span>                                                value<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>                                save<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; rounding n.forests to the nearest one</span></span></code></pre></div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Internally, the ERF algorithm uses the <code>ROCR</code> package to calculate model performance. We can see how this occurs internally using the <code>rocr_ens</code> function on the provided dataset <code>simData</code>. The <code>rocr_ens</code> function calculates a battery of performance metrics based on the Receiver Operator Characteristic curve calculated from the <code>ROCR</code> package functions <code>prediction</code> and <code>performance</code> functions. The <code>prediction</code> function works on any set of predictions (ranging from (0,1)) and any set of observations (as a <code>factor</code>) and, likewise, the <code>rocr_ens</code> is a wrapper to do it in one step.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the rocr_ens function takes the predictions (or true probability in this case)</span></span>
<span><span class="co"># as the first argument. The true observations as a factor class are the</span></span>
<span><span class="co"># second argument. </span></span>
<span><span class="va">roc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">simData</span><span class="op">$</span><span class="va">samples</span>,<span class="fu"><a href="../reference/rocr_ens.html">rocr_ens</a></span><span class="op">(</span><span class="va">prob</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">obs</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can see all the performance metrics returned from the rocr_ens function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">roc</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "tpr"  "tnr"  "auc"  "phi"  "acc"  "err"  "fpr"  "sens" "spec" "tss" </span></span>
<span><span class="co">#&gt; [11] "rmse"</span></span></code></pre></div>
<p>With the exception of the the area-under-the ROC curve (AUC), the true skill statistic (TSS), and the root mean squared error (RMSE) metrics, all others are calculated over a range of threshold values that split the continuous probability of presence predictions into binary (0,1) predictions. By comparing the true positive rate (TPR) or sensitivity to the false positive rate (FPR) or 1-specificity, we can visualize the ROC curve.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can visualize the resulting Receiver Operator Characteristic curve</span></span>
<span><span class="co"># and add some of the threshold-free performance metrics (AUC, TSS, RMSE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roc</span><span class="op">$</span><span class="va">fpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">roc</span><span class="op">$</span><span class="va">tpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"False Positive Rate (1-Specificity)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True Positive Rate (Sensitivity)"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'l'</span>, lwd<span class="op">=</span><span class="fl">3</span>, las<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'AUC = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">roc</span><span class="op">$</span><span class="va">auc</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">1.2</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.125</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'TSS = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">roc</span><span class="op">$</span><span class="va">tss</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">1.2</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.0525</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'RMSE = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">roc</span><span class="op">$</span><span class="va">rmse</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, cex<span class="op">=</span><span class="fl">1.2</span>, adj<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-perf_files/figure-html/sim_data_r-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="internal-performance-metrics">Internal performance metrics<a class="anchor" aria-label="anchor" href="#internal-performance-metrics"></a>
</h2>
<p>The ERF algorithm produces a set of ensemble, mean training set, and mean test set performance metrics in addition to the performance for the training and test sets for each Random Forests in the ensemble.</p>
<p>We can view the ensemble performance for the three key metrics evaluated in <a href="https://www.int-res.com/abstracts/esr/v43/p183-197/" class="external-link">Siders et al. 2020</a>: AUC, TSS, and RMSE. Generally, we want an AUC &gt; 0.5, TSS close to 1, and a low RMSE for a high performing model.</p>
<div class="section level3">
<h3 id="ensemble-threshold-free-performance">Ensemble threshold-free performance<a class="anchor" aria-label="anchor" href="#ensemble-threshold-free-performance"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view the threshold-free ensemble performance metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'auc'</span>,<span class="st">'rmse'</span>,<span class="st">'tss'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;       auc      rmse       tss </span></span>
<span><span class="co">#&gt; 0.9717278 0.3788242 0.8129154</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-test-threshold-free-performance">Training and test threshold-free performance<a class="anchor" aria-label="anchor" href="#training-and-test-threshold-free-performance"></a>
</h3>
<p>We can also view these same metrics for mean across training and test sets.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view the mean training threshold-free performance metrics for each RF</span></span>
<span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">mu.tr.perf</span></span>
<span><span class="co">#&gt;     trAUC    trRMSE     trTSS </span></span>
<span><span class="co">#&gt; 0.9828774 0.3793560 0.8651261</span></span>
<span><span class="co"># view the mean test threshold-free performance metrics for each RF</span></span>
<span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">mu.te.perf</span></span>
<span><span class="co">#&gt;     teAUC    teRMSE     teTSS </span></span>
<span><span class="co">#&gt; 0.7869439 0.3884791 0.5255065</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="receiver-operator-characteristic-curve">Receiver Operator Characteristic Curve<a class="anchor" aria-label="anchor" href="#receiver-operator-characteristic-curve"></a>
</h3>
<p>We can also plot some of the threshold-dependent performance metrics. First, we can plot the ROC curve for the ensemble predictions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can visualize the resulting Receiver Operator Characteristic curve</span></span>
<span><span class="co"># and add some of the threshold-free performance metrics (AUC, TSS, RMSE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">$</span><span class="va">fpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>     <span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">$</span><span class="va">tpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"False Positive Rate (1-Specificity)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True Positive Rate (Sensitivity)"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'l'</span>, lwd<span class="op">=</span><span class="fl">3</span>, las<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-perf_files/figure-html/ens_roc-1.png" width="384" style="display: block; margin: auto;"></p>
<p>We can see that the model does very well from the ROC curve as the solid line is well above the dotted line indicating the expected performance from random chance.</p>
<p>We can also view the training and test performance of every Random Forests within the ensemble.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can visualize the resulting Receiver Operator Characteristic curve</span></span>
<span><span class="co"># and add some of the threshold-free performance metrics (AUC, TSS, RMSE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#training FPR and TPR</span></span>
<span><span class="va">fpr.tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">roc_train</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">fpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tpr.tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">roc_train</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">tpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#test FPR and TPR</span></span>
<span><span class="va">fpr.te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">roc_test</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">fpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tpr.te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">roc_test</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">tpr</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fpr.tr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">tpr.tr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"False Positive Rate (1-Specificity)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"True Positive Rate (Sensitivity)"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'l'</span>, lwd<span class="op">=</span><span class="fl">3</span>, las<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">'gray90'</span><span class="op">)</span></span>
<span><span class="co">#each training ROC curve</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fpr.tr</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fpr.tr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="va">tpr.tr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'gray90'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#each test ROC curve</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fpr.te</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">fpr.te</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="va">tpr.te</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'gray40'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="model-perf_files/figure-html/rf_roc-1.png" width="384" style="display: block; margin: auto;"></p>
<p>We can see above that the training set performance is higher than the test set performance. This is a common feature of machine learning algorithms. <a href="https://www.int-res.com/abstracts/esr/v43/p183-197/" class="external-link">Siders et al. 2020</a> discusses the comparison between the ensemble performance and the test performance. Classification performance metrics are an area with considerable discourse that is beyond the purview of this vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="thresholds">Thresholds<a class="anchor" aria-label="anchor" href="#thresholds"></a>
</h2>
<p>Thresholds are a common way to classify the continuous probability of presence predictions (bounded between 0 and 1) to binary predictions. There is some debate on the “best” threshold performance metric. See <a href="https://onlinelibrary.wiley.com/doi/pdf/10.1111/jbi.12058" class="external-link">Liu et al. 2013</a> for a discussion of some of the commonly used thresholds in presence-only modeling that is relevant to ERF.</p>
<p>Below, we calculate the maximum sensitivity and specificity threshold. It is generally in the top set of thresholds when various thresholds are compared. It is by no means the only one we could calculate.</p>
<div class="section level3">
<h3 id="ensemble-threshold-dependent-performance">Ensemble threshold-dependent performance<a class="anchor" aria-label="anchor" href="#ensemble-threshold-dependent-performance"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the index of the threshold (cutoff) value that gives </span></span>
<span><span class="co"># the maximum sum of sensitivity and specificity (MSS)</span></span>
<span><span class="va">thres.id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">$</span><span class="va">sens</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                         <span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">$</span><span class="va">spec</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Get the threshold value</span></span>
<span><span class="va">thres</span> <span class="op">&lt;-</span> <span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span><span class="op">$</span><span class="va">sens</span><span class="op">@</span><span class="va">x.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">thres.id</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Besides AUC, TSS, and RMSE, all other performance values were threshold-</span></span>
<span><span class="co"># dependent of of class 'performance'. We can apply our MSS threshold to each</span></span>
<span><span class="co"># of these and get performance metrics value at that threshold. We can also</span></span>
<span><span class="co"># return the AUC, TSS, RMSE with the ifelse statement.</span></span>
<span><span class="va">perf.val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">ens.perf</span>, </span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="st">'performance'</span>,</span>
<span>                                       <span class="va">x</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">thres.id</span><span class="op">]</span>,</span>
<span>                                       <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">perf.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">perf.val</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                      Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'True Positive Rate'</span>,</span>
<span>                               <span class="st">'True Negative Rate'</span>,</span>
<span>                               <span class="st">'Area Under the Curve'</span>,</span>
<span>                               <span class="st">'Correlation Coefficient'</span>,</span>
<span>                               <span class="st">'Accuracy'</span>,</span>
<span>                               <span class="st">'Error'</span>,</span>
<span>                               <span class="st">'False Positive Rate'</span>,</span>
<span>                               <span class="st">'Sensitivity'</span>,</span>
<span>                               <span class="st">'Specificity'</span>,</span>
<span>                               <span class="st">'True Skill Statistic'</span>,</span>
<span>                               <span class="st">'Root Mean Squared Error'</span><span class="op">)</span>,</span>
<span>                      lower.bnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>                      upper.bnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                      perfect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">perf.df</span>, caption <span class="op">=</span> <span class="st">"Ensemble Performance"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Ensemble Performance</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Metric</th>
<th align="left">Name</th>
<th align="right">lower.bnd</th>
<th align="right">upper.bnd</th>
<th align="right">perfect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">tpr</td>
<td align="right">0.934</td>
<td align="left">True Positive Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tnr</td>
<td align="right">0.879</td>
<td align="left">True Negative Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">auc</td>
<td align="right">0.972</td>
<td align="left">Area Under the Curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">phi</td>
<td align="right">0.317</td>
<td align="left">Correlation Coefficient</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">acc</td>
<td align="right">0.880</td>
<td align="left">Accuracy</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">err</td>
<td align="right">0.120</td>
<td align="left">Error</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">fpr</td>
<td align="right">0.121</td>
<td align="left">False Positive Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sens</td>
<td align="right">0.934</td>
<td align="left">Sensitivity</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">spec</td>
<td align="right">0.879</td>
<td align="left">Specificity</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tss</td>
<td align="right">0.813</td>
<td align="left">True Skill Statistic</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rmse</td>
<td align="right">0.379</td>
<td align="left">Root Mean Squared Error</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="test-threshold-dependent-performance">Test threshold-dependent performance<a class="anchor" aria-label="anchor" href="#test-threshold-dependent-performance"></a>
</h3>
<p>We can also perform the same procedure on the test performance by calculating a threshold for each test set for each Random Forests in the ensemble and calculating the performance. We can then take the mean across the test sets to get the mean test performance for a suite of metrics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Same procedure as above but on each test set</span></span>
<span><span class="va">test.perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ens_rf_ex</span><span class="op">$</span><span class="va">roc_test</span>, </span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">sens</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> </span>
<span>                                                   <span class="va">x</span><span class="op">$</span><span class="va">spec</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>;  </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="st">'performance'</span>,</span>
<span>                                                 <span class="va">y</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>,</span>
<span>                                                 <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>                    <span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Average test performance</span></span>
<span><span class="va">test.perf.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">test.perf</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>                      Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'True Positive Rate'</span>,</span>
<span>                               <span class="st">'True Negative Rate'</span>,</span>
<span>                               <span class="st">'Area Under the Curve'</span>,</span>
<span>                               <span class="st">'Correlation Coefficient'</span>,</span>
<span>                               <span class="st">'Accuracy'</span>,</span>
<span>                               <span class="st">'Error'</span>,</span>
<span>                               <span class="st">'False Positive Rate'</span>,</span>
<span>                               <span class="st">'Sensitivity'</span>,</span>
<span>                               <span class="st">'Specificity'</span>,</span>
<span>                               <span class="st">'True Skill Statistic'</span>,</span>
<span>                               <span class="st">'Root Mean Squared Error'</span><span class="op">)</span>,</span>
<span>                      lower.bnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>                      upper.bnd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                      perfect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">test.perf.df</span>, caption <span class="op">=</span> <span class="st">"Mean Test Performance"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Mean Test Performance</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Metric</th>
<th align="left">Name</th>
<th align="right">lower.bnd</th>
<th align="right">upper.bnd</th>
<th align="right">perfect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">tpr</td>
<td align="right">0.842</td>
<td align="left">True Positive Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tnr</td>
<td align="right">0.683</td>
<td align="left">True Negative Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">auc</td>
<td align="right">0.787</td>
<td align="left">Area Under the Curve</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">phi</td>
<td align="right">0.154</td>
<td align="left">Correlation Coefficient</td>
<td align="right">-1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">acc</td>
<td align="right">0.686</td>
<td align="left">Accuracy</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">err</td>
<td align="right">0.314</td>
<td align="left">Error</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">fpr</td>
<td align="right">0.317</td>
<td align="left">False Positive Rate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sens</td>
<td align="right">0.842</td>
<td align="left">Sensitivity</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">spec</td>
<td align="right">0.683</td>
<td align="left">Specificity</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tss</td>
<td align="right">0.526</td>
<td align="left">True Skill Statistic</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rmse</td>
<td align="right">0.388</td>
<td align="left">Root Mean Squared Error</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zachary Siders.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
